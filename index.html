<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>í‹°ë‹ˆí•‘ ì´ë¦„ ë§ì¶”ê¸° ê²Œì„</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
    #game-container { max-width: 400px; margin: 0 auto; }
    h1 { font-size: 2em; }
    #character-img, #character-video {
      width: 100%; height: auto;
      border: 2px solid #ccc; border-radius: 8px;
    }
    .choice-btn {
      display: inline-block;
      margin: 8px;
      padding: 10px 20px;
      font-size: 2em;
      cursor: pointer;
      border: 1px solid #888;
      border-radius: 4px;
      background: #f0f0f0;
    }
    .choice-btn:hover { background: #e0e0e0; }
    #answer-text { margin-top: 12px; font-size: 1.5em; font-weight: bold; }
    #message { margin-top: 12px; height: 24px; color: red; font-weight: bold; }
    .next-btn {
      margin-top: 12px;
      padding: 8px 16px;
      font-size: 1em;
      cursor: pointer;
      border: 1px solid #4CAF50;
      border-radius: 4px;
      background: #4CAF50;
      color: white;
    }
    .next-btn:hover { background: #45A049; }
  </style>
</head>
<body>
  <div id="game-container">
    <h1>í‹°ë‹ˆí•‘ ì´ë¦„ ë§ì¶”ê¸°</h1>
    <div>
      <img id="character-img" src="" alt="ìºë¦­í„° ì´ë¯¸ì§€">
      <!-- âœ… ìƒ¤ìƒ¤í•‘ ì •ë‹µ ì‹œ í‘œì‹œë˜ëŠ” ë¹„ë””ì˜¤ -->
      <video id="character-video" style="display:none;" playsinline muted loop></video>
    </div>
    <div id="answer-text"></div> <!-- â¬…ï¸ ìœ„ì¹˜ ì¤‘ìš” -->
    <div id="choices1"></div>
    <div id="choices2" style="display:none;"></div>
    <div id="message"></div>
  </div>

  <script>
    // ====== TTS ì¤€ë¹„ ======
    let sunhiVoice = null;
    function initTTS() {
      const voices = speechSynthesis.getVoices();
      sunhiVoice = voices.find(v => v.lang === 'ko-KR' && v.name && v.name.includes('SunHi'));
      if (sunhiVoice) {
        const warm = new SpeechSynthesisUtterance('');
        warm.lang = 'ko-KR';
        warm.voice = sunhiVoice;
        speechSynthesis.speak(warm);
      }
    }
    speechSynthesis.onvoiceschanged = initTTS;
    initTTS();

    function speak(text) {
      try {
        speechSynthesis.cancel();
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'ko-KR';
        if (sunhiVoice) utter.voice = sunhiVoice;
        speechSynthesis.speak(utter);
      } catch(e) {
        // ì¼ë¶€ í™˜ê²½ì—ì„œ speechSynthesis ë¯¸ì§€ì›ì‹œ ë¬´ì‹œ
      }
    }

    // ====== ìºë¦­í„° ëª©ë¡ (ìƒ¤ìƒ¤í•‘ì—ë§Œ video ì†ì„± ì¶”ê°€) ======
    const characters = [
      { name: 'ëª¨ì•¼í•‘', img: 'moyaping.png' },
      { name: 'ì•„ìí•‘', img: 'ajaping.png' },
      { name: 'ì”½ì”½í•‘', img: 'ssingssingping.png' },
      { name: 'í•˜ì¸„í•‘', img: 'hachuupping.jpeg' },
      { name: 'ê¹¡ì´í•‘', img: 'kkangchongping.png' },
      { name: 'ë¼ë¼í•‘', img: 'raraping.png' },
      { name: 'ìª¼ê¼¼í•‘', img: 'jjokkomping.png' },
      { name: 'ì°Œë¦¿í•‘', img: 'jjiritping.png' },
      { name: 'ê¾¸ë˜í•‘', img: 'kkuraeping.png' },
      { name: 'ìƒ¤ìƒ¤í•‘', img: 'syasyaping.png', video: 'syasyaping.mp4' }, // âœ… ì—¬ê¸°ë§Œ ë¹„ë””ì˜¤ ì„¤ì •
      { name: 'ë…¸ë¼í•‘', img: 'noraping.png' },
      { name: 'íŠ¸ëŸ¬í•‘', img: 'teureoping.jpeg' },
      { name: 'ë‚˜ë¥´í•‘', img: 'nareuping.png' },
      { name: 'ë§›ë‚˜í•‘', img: 'matnaping.png' },
      { name: 'êº¼ê¿€í•‘', img: 'kkeokkulping.png' },
      { name: 'ë‚˜ë‚˜í•‘', img: 'nanaping.png' },
      { name: 'ê°„í˜¸í•‘', img: 'ganhoping.png' },
      { name: 'ë¯¿ì–´í•‘', img: 'mideoping.png' },
      { name: 'ë°”ë„¤í•‘', img: 'baneping.png' },
      { name: 'ë”©ë™í•‘', img: 'dingdongping.png' },
      { name: 'í¬ì‹¤í•‘', img: 'posilping.png' },
      { name: 'ëˆˆê½ƒí•‘', img: 'nunkkotping.png' },
      { name: 'ì°¨ìºí•‘', img: 'chakyaeping.png' },
      { name: 'ë² ë² í•‘', img: 'bebeping.png' },
      { name: 'ì•„ì‰í•‘', img: 'ayingping.png' },
      { name: 'í›Œë¼í•‘', img: 'hullaping.png' },
      { name: 'í•«ì¼€í•‘', img: 'hatkeping.png' },
      { name: 'ì£¼ë„¤í•‘', img: 'juneping.png' },
      { name: 'ê¹œë¹¡í•‘', img: 'kkambbakping.png' },
      { name: 'ìª¼ê¼¬í•‘', img: 'jjokkoping.png' },
      { name: 'ë¹›ë‚˜í•‘', img: 'bitnaping.jpeg' },
      { name: 'ì•„íœ´í•‘', img: 'ahyuping.png' },
      { name: 'ì–Œì–Œí•‘', img: 'yamyamping.png' },
      { name: 'ë¿Œë¿Œí•‘', img: 'ppuppuping.png' },
      { name: 'ë°”ë¡œí•‘', img: 'baroping.jpeg' },
      { name: 'í† ì´í•‘', img: 'toiping.png' },
      { name: 'ëšë”±í•‘', img: 'ttukttakping.png' },
      { name: 'ê°€ë©´í•‘', img: 'gamyunping.png' },
      { name: 'ê³ ë§ˆí•‘', img: 'gomaping.png' },
      { name: 'ê³µì¥¬í•‘', img: 'gongjyuping.png' },
      { name: 'ê·¸ë¦¼í•‘', img: 'geurimping.png' },
      { name: 'ê¹Œë¥´í•‘', img: 'kkareuping.png' },
      { name: 'ë‚˜ëˆ”í•‘', img: 'nanumping.png' },
      { name: 'ë‹¬ì½¤í•‘', img: 'dalkomping.png' },
      { name: 'ëœëœí•‘', img: 'deoldeolping.png' },
      { name: 'ë”°ë¼í•‘', img: 'ttaraping.png' },
      { name: 'ë”±í’€í•‘', img: 'ttakpulping.png' },
      { name: 'ë§ˆì¹´í•‘', img: 'makaping.png' },
      { name: 'ë§ë‘í•‘', img: 'mallangping.png' },
      { name: 'ë©”ëª¨í•‘', img: 'memoping.png' },
      { name: 'ë©œë¡œí•‘', img: 'melloping.jpeg' },
      { name: 'ë¬´ê±°í•‘', img: 'mugeoping.png' },
      { name: 'ë°œë ˆí•‘', img: 'balleping.png' },
      { name: 'ë¶€ë„í•‘', img: 'bukkeuping.png' },
      { name: 'ë¹™ê¸€í•‘', img: 'binggeulping.png' },
      { name: 'ë¹¤ì§í•‘', img: 'banjakping.jpeg' },
      { name: 'ì‚ì§í•‘', img: 'ppijimping.png' },
      { name: 'ì†Œì›í•‘', img: 'sowonping.png' },
      { name: 'ì†”ì°Œí•‘', img: 'soljjiping.png' },
      { name: 'ì•™ëŒ€í•‘', img: 'angdaeping.png' },
      { name: 'ìš”ê±°í•‘', img: 'yogeoping.png' },
      { name: 'ì§ì§í•‘', img: 'jjakjjakping.png' },
      { name: 'ì°¨ì°¨í•‘', img: 'chachaping.png' },
      { name: 'íˆ¬íˆ¬í•‘', img: 'tutuping.png' },
      { name: 'íŒ¨ì…˜í•‘', img: 'paesyonping.png' },
      { name: 'í•¨ê»˜í•‘', img: 'hamkkaeping.png' },
      { name: 'í™”ë‚˜í•‘', img: 'hwanaping.png' },
      { name: 'í˜ë‚´í•‘', img: 'himnaeping.png' }
    ];

    // ====== ìœ í‹¸ ======
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // ====== ê²Œì„ ìƒíƒœ ======
    let questions = shuffle([...characters]);
    let currentIndex = 0;
    let selectedFirst = null;
    let selectedSecond = null;

    // ====== ë¬¸ì œ ë¡œë“œ ======
    function loadQuestion() {
      const videoEl = document.getElementById('character-video');
      const imgEl = document.getElementById('character-img');

      // ğŸ”„ ì´ì „ ë¬¸ì œì˜ ë¹„ë””ì˜¤ ìƒíƒœ ì™„ì „ ì´ˆê¸°í™”
      try { videoEl.pause(); } catch(e){}
      videoEl.removeAttribute('src');
      videoEl.load();
      videoEl.style.display = 'none';

      imgEl.style.display = 'block';

      const current = questions[currentIndex];
      const syllables = [...current.name];
      const correctFirst = syllables[0];

      document.getElementById('character-img').src = current.img;
      document.getElementById('message').textContent = '';
      document.getElementById('choices2').style.display = 'none';
      document.getElementById('answer-text').innerHTML = `<div style="font-size: 1.5em; font-weight: bold;">ì •ë‹µ: OOí•‘</div>`;
      selectedFirst = null;
      selectedSecond = null;

      const choicesCount1 = 4;
      const allFirstSyllables = [...new Set(characters.map(c => [...c.name][0]))];
      let firstChoices = allFirstSyllables.filter(s => s !== correctFirst);
      firstChoices = shuffle(firstChoices).slice(0, choicesCount1 - 1);
      firstChoices.push(correctFirst);
      firstChoices = shuffle(firstChoices);

      const c1 = document.getElementById('choices1');
      c1.innerHTML = '';
      firstChoices.forEach(ch => {
        const btn = document.createElement('button');
        btn.textContent = ch;
        btn.className = 'choice-btn';
        btn.onclick = () => {
          speak(ch);
          selectedFirst = ch;
          if (ch === correctFirst) {
            document.getElementById('message').textContent = '';
            document.getElementById('choices1').style.display = 'none';
            setupSecond(current);
          } else {
            document.getElementById('message').textContent = 'í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
          }
        };
        c1.appendChild(btn);
      });
      c1.style.display = 'block';
    }

    // ====== ë‘ ë²ˆì§¸ ìŒì ˆ ì„ íƒ ì„¸íŒ… ======
    function setupSecond(current) {
      const syllables = [...current.name];
      const correctSecond = syllables[1];

      const choicesCount2 = 4;
      const allSecondSyllables = [...new Set(characters.map(c => [...c.name][1]))];
      let secondChoices = allSecondSyllables.filter(s => s !== correctSecond);
      secondChoices = shuffle(secondChoices).slice(0, choicesCount2 - 1);
      secondChoices.push(correctSecond);
      secondChoices = shuffle(secondChoices);

      const c2 = document.getElementById('choices2');
      c2.innerHTML = '';
      document.getElementById('answer-text').innerHTML = `
        <div style="font-size: 1.5em; font-weight: bold;">ì •ë‹µ: ${selectedFirst}Oí•‘</div>
      `;

      secondChoices.forEach(ch => {
        const btn = document.createElement('button');
        btn.textContent = ch;
        btn.className = 'choice-btn';
        btn.onclick = () => {
          speak(ch);
          selectedSecond = ch;
          checkAnswer(current);
        };
        c2.appendChild(btn);
      });

      c2.style.display = 'block';
    }

    // ====== ì •ë‹µ ì²´í¬ ======
    function checkAnswer(current) {
      const syllables = [...current.name];
      if (selectedFirst === syllables[0] && selectedSecond === syllables[1]) {
        document.getElementById('message').textContent = '';
        showCorrect();
      } else {
        document.getElementById('message').textContent = 'í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.';
        // ì •ë‹µ í‘œì‹œëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€
      }
    }

    // ====== ì •ë‹µ ì²˜ë¦¬ (ìƒ¤ìƒ¤í•‘ì¼ ë•Œë§Œ ë¹„ë””ì˜¤ ì¬ìƒ) ======
    function showCorrect() {
      const current = questions[currentIndex];
      speak(current.name);

      const videoEl = document.getElementById('character-video');
      const imgEl   = document.getElementById('character-img');

      // ìƒ¤ìƒ¤í•‘ ë“± video ì†ì„±ì´ ìˆëŠ” ìºë¦­í„°ë§Œ ë¹„ë””ì˜¤ ì „í™˜
      if (current.video) {
        imgEl.style.display = 'none';
        videoEl.src = current.video; // syasyaping.mp4
        videoEl.style.display = 'block';
        videoEl.muted = true; // ëª¨ë°”ì¼ ìë™ì¬ìƒ í˜¸í™˜
        videoEl.play().catch(() => {
          // ìë™ì¬ìƒ ì°¨ë‹¨ëœ ê²½ìš° ì»¨íŠ¸ë¡¤ëŸ¬ ë…¸ì¶œ
          videoEl.setAttribute('controls', 'controls');
        });
      }

      document.getElementById('choices2').style.display = 'none';
      document.getElementById('answer-text').innerHTML = `
        <div style="margin-top: 8px; font-size: 1.5em; font-weight: bold;">ì •ë‹µ: ${current.name}</div>
        <button id="next-btn" class="next-btn">Next</button>
      `;

      document.getElementById('next-btn').onclick = () => {
        // ë‹¤ìŒ ë¬¸ì œë¡œ ë„˜ì–´ê°ˆ ë•Œ ë¹„ë””ì˜¤/ì´ë¯¸ì§€ ìƒíƒœ ë¦¬ì…‹
        try { videoEl.pause(); } catch(e){}
        videoEl.removeAttribute('src');
        videoEl.load();
        videoEl.style.display = 'none';
        imgEl.style.display = 'block';

        currentIndex++;
        if (currentIndex < questions.length) {
          loadQuestion();
        } else {
          document.getElementById('game-container').innerHTML = '<h2>ğŸ‰ ëª¨ë“  ë¬¸ì œë¥¼ ì™„ë£Œí–ˆìŠµë‹ˆë‹¤!</h2>';
        }
      };
    }

    // ê²Œì„ ì‹œì‘
    loadQuestion();
  </script>
</body>
</html>
